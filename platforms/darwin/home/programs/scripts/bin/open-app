#!/usr/bin/env bash

CACHE_FILE="$HOME/.cache/open-app"
if [ -e "$CACHE_FILE" ] \
    && [ "$(date +'%j')" -eq "$(date -r "$(stat -f '%m' "$CACHE_FILE")" +'%j')" ]; then
    echo "Reading from cache"
else
    rm -f "$CACHE_FILE"
    find \
        /System/Applications \
        /System/Applications/Utilities \
        /System/Library/CoreServices \
        /Applications \
        /Applications/Utilities \
        $HOME/Applications/Nix \
        -maxdepth 1 -name "*.app" \
        | sed -e "s/.*\///g" -e "s/\.app//" \
        | sort > "$CACHE_FILE"
fi

applications="$(cat "$CACHE_FILE")"
application="$(echo "$applications" | choose -n 10 -c bd93f9 -b 282a36 -s 22 -f "Fira Code")"
[ "$application" ] && open -a "$application"
